function getBackgroundAsset(a){$.get("https://6v0luvcal3.execute-api.us-west-2.amazonaws.com/prod/backgroundimagecached",a).fail(fallback)}var crrImg;function loadImage(a){crrImg=a;url=a.high_res_comp;$("body").css({backgroundImage:"url('"+url+"')"});title=toTitleCase(a.title);$(".info-box .title").text(title);$(".info-box .artist").text(getLocString("credit")+a.artist);$("body").click(bodyClick);$(".img-info .icon").click(toggleDetails);$(".getty-link").attr("href","http://www.gettyimages.com/search/more-like-this/"+a.id+"?assettype=image&family=creative&esource=chrome-extension");$(".photoscom").attr("href","http://www.photos.com/photo/"+a.id+"?utm_source=chrome-extension");if(navigator.language!="en-US"){$(".photoscom").hide()}$("#options-btn").click(loadOptions)}var $infoBox=$(".info-box");var $imgCaption=$(".img-caption");var $creditIcon=$(".icon .credit");function toTitleCase(a){return a.replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})}function toggleDetails(){if($infoBox.css("opacity")=="1"){hideDetails()}else{showDetails()}}function showDetails(){$infoBox.stop();$creditIcon.animate({opacity:0});$imgCaption.stop().animate({maxWidth:0},function(){$infoBox.show().animate({opacity:1},function(){$(".img-info").removeClass("collapsed");$creditIcon.hide();$imgCaption.hide()})})}function bodyClick(){if($infoBox.is(":hover")||$(".img-info .icon").is(":hover")){return}hideDetails()}function hideDetails(){$imgCaption.stop();$imgCaption.text(getLocString("credit")+crrImg.artist).delay(500).animate({maxWidth:"33vw"});$creditIcon.css("display","inline-block").animate({opacity:1});$infoBox.stop().animate({opacity:0},function(){$infoBox.hide();$imgCaption.show().animate({maxWidth:"33vw"},function(){$(".img-info").addClass("collapsed")})})}function loadOptions(){$.get(chrome.extension.getURL("options.html"),function(b){var c=b.indexOf("<body>")+6;var a=b.indexOf("</body>");$("#options-dialog").html(b.substring(c,a));optionsInit(true);$("#screen").show();$("#options-dialog").show()})}getBackgroundAsset(function(a){if(a&&a.high_res_comp){loadImage(a)}else{fallback()}});function fallback(){response={high_res_comp:"/images/133462856.jpg",artist:"Life On White",id:133462856,title:"Atlantic Puffins on Mykines"};loadImage(response)}var locHash={"en-GB":"GBR","en-AU":"AUS","pt-BR":"BRA","en-CA":"CAN","fr-CA":"CAN",de:"DEU",fr:"FRA",it:"ITA",ja:"JPN","en-MX":"MEX",es:"ESP"};var jaguarCategs=[];var selectedCategIndex=0;function getJaguarCategs(a,b){if(!a){a="USA"}$.get("https://s3-us-west-2.amazonaws.com/connect-chrome-extension-cache/recommendations/"+a+".json",b)}function getCategTranslations(a){$.get("https://s3-us-west-2.amazonaws.com/connect-chrome-extension-cache/categories_loc.json",function(b){var d=JSON.parse(b);var c=d[navigator.language];if(!c){c=d.en}a(c)})}function showCarousel(){$("#carousel .content").on("init",showTooltips).slick({dots:true,speed:300,slidesToShow:10,slidesToScroll:10,centerMode:false,variableWidth:true,infinite:false})}function showTooltips(){$(document).tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){$(this).css(a)}}})}function insertCarouselImage(e,b,d){var c=b?b.replace(/'/g,"&#39;"):"";var a="http://www.gettyimages.com/detail/photo/chrome-extension/"+e+"?esource=chrome-extension";$("#carousel .content").append("<div><a data-id='"+e+"' class='item' href='"+a+"'><img title='"+c+"' src='"+d+"'/></a></div>")}$("#carousel-source").on("click","li",function(){index=$(this).index();if(index==selectedCategIndex){return}$(document).tooltip("destroy");selectedCategIndex=index;showJaguarRecommendations(index);localStorage.setItem("categIndex",index);trackCarouselCategoryClicked(jaguarCategs[index])});$("#carousel").on("click","button",function(){var a=$(this).parent().index()+1;var b=$("#carousel-source .selected").data("categ");trackCarouselPageClicked(a,jaguarCategs[selectedCategIndex])});var hoverTimeoutId;$("#carousel").on("mouseenter",".slick-slide",function(){var a=$(this);hoverTimeoutId=setTimeout(function(){trackCarouselAssetHover(getSlideDetails(a))},500)}).on("mouseleave",".slick-slide",function(){clearTimeout(hoverTimeoutId)}).on("click","a.item",function(b){$a=$(this);b.preventDefault();var a=$(this).closest(".slick-slide");trackCarouselAssetClicked(getSlideDetails(a),function(){window.location=$a.attr("href")})});function getSlideDetails(b){var a=b.data("slick-index");return{id:b.find("a.item").data("id")+"",categ:jaguarCategs[selectedCategIndex].name,position:a,metadata:jaguarCategs[selectedCategIndex].assets[a].properties}}function init(){var a;$(document).on("optionsChanged",function(b,c){$("#carousel-container").css("display",c.showCarousel?"block":"none");a=c.carouselCategory});$carousel=$("#carousel-source");country=locHash[navigator.language];$carousel.html("");getJaguarCategs(country,function(b){jaguarCategs=JSON.parse(b);getCategTranslations(function(c){var d;index=0;jaguarCategs.forEach(function(e){if(a==e.name){selectedCategIndex=index}index++;e.translatedName=translateCateg(c,e.name);$carousel.append("<li data-categ='"+e.name+"'>"+e.translatedName+"</li>")});showJaguarRecommendations(selectedCategIndex);trackCarouselCategoryClicked(jaguarCategs[selectedCategIndex],true)})})}function translateCateg(a,b){for(var c=0;c<a.length;c++){if(a[c].name==b){return a[c].translation}}return""}function showJaguarRecommendations(a){categ=jaguarCategs[a];$("#carousel-source li").removeClass("selected");$("#carousel-source li:nth-child("+(a+1)+")").addClass("selected");$("#carousel").html("").append("<div class='content'></div>");images=categ.assets;images.forEach(function(b){insertCarouselImage(b.id,b.caption,b.delivery_urls.thumb)});showCarousel()}init();var dateString="";var clockString="";var clockStyle="default";function updateClock(){var c=new Date();var d=navigator.language;dateSt=c.toLocaleDateString(d,{weekday:"long",month:"long",day:"numeric"});if(dateSt!=dateString){dateString=dateSt;$("#date").html(dateSt)}opt={hour:"2-digit",minute:"2-digit"};if(clockStyle!="default"){opt.hour12=(clockStyle=="12h")}clockSt=c.toLocaleTimeString(d,opt);if(clockSt!=clockString){clockString=clockSt;var a=["<em>",clockSt,"</em>"].join("");var b=clockSt.match(/([0-9]|0[0-9]|1?[0-9]|2[0-3]):[0-5]?[0-9]/);if(b&&b[0]!=clockSt){start=clockSt.indexOf(b[0]);end=start+b[0].length;var a=[clockSt.slice(0,start),"<em>",clockSt.slice(start,end),"</em>",clockSt.slice(end)].join("")}$("#clock").html(a)}}$(document).ready(function(){updateClock();window.setInterval(updateClock,1000);$(document).on("optionsChanged",function(a,b){$("#clock-date").css("display",b.showClock?"block":"none");clockStyle=b.clockStyle;updateClock()})});function getCookie(d){var b=d+"=";var a=document.cookie.split(";");for(var e=0;e<a.length;e++){var f=a[e];while(f.charAt(0)==" "){f=f.substring(1)}if(f.indexOf(b)==0){return f.substring(b.length,f.length)}}return""}function setCookie(b,f,c){if(!c){c=10000}var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var a="expires="+e.toUTCString();document.cookie=b+"="+f+"; "+a}function getLocString(a){return chrome.i18n.getMessage(a)}$(document).ready(function(){$("[data-loc]").each(function(){$(this).html(getLocString($(this).data("loc")))});$("[data-placeholder-loc]").each(function(){$(this).attr("placeholder",getLocString($(this).data("placeholder-loc")))})});var $showSearchBox;var $showCarousel;var $showClock;var $defaultCarouselCateg;function saveOptions(a){items={showSearchBox:$showSearchBox.is(":checked"),showClock:$showClock.is(":checked"),showCarousel:$showCarousel.is(":checked"),clockStyle:$("input[name=clock-style]:checked").val(),carouselCategory:$defaultCarouselCateg.val()};chrome.storage.sync.set(items,function(){$(document).trigger("optionsChanged",items);$("#status").show();setTimeout(function(){$("#status").hide();hideDialog()},750)})}function hideDialog(){$("#options-dialog").hide();$("#screen").hide()}function optionsInit(a){$showSearchBox=$("#show-search-box");$showCarousel=$("#show-carousel");$showClock=$("#show-clock");$defaultCarouselCateg=$("#default-carousel-category select");$(".options-header [data-loc], .options [data-loc]").each(function(){$(this).html(getLocString($(this).data("loc")))});if(a){$("#options-dialog").addClass("full")}initCarouselOptions();populateOptions();$("#save").click(saveOptions);$(".options-header .close").click(closeDialog);$(document).keyup(function(b){if(b.keyCode===27){closeDialog()}})}function initCarouselOptions(){jaguarCategs.forEach(function(a){var b=new Option(a.translatedName,a.name);$defaultCarouselCateg.append($(b))})}function populateOptions(){getOptions(function(a){$showSearchBox.prop("checked",a.showSearchBox);$showCarousel.prop("checked",a.showCarousel);toggleCarousel(!a.showCarousel);$showClock.prop("checked",a.showClock);toggleClockStyle(!a.showClock);$("input[name=clock-style]").removeAttr("checked");$("input[name=clock-style][value="+a.clockStyle+"]").click();if(a.carouselCategory){$defaultCarouselCateg.val(a.carouselCategory)}$(document).trigger("optionsChanged",a);instantFeedback(a)})}function closeDialog(){populateOptions();hideDialog()}function instantFeedback(a){$showSearchBox.click(function(){a.showSearchBox=$showSearchBox.is(":checked");$(document).trigger("optionsChanged",a)});$showCarousel.click(function(){a.showCarousel=$showCarousel.is(":checked");$(document).trigger("optionsChanged",a);toggleCarousel(!a.showCarousel)});$showClock.click(function(){a.showClock=$showClock.is(":checked");$(document).trigger("optionsChanged",a);toggleClockStyle(!a.showClock)});$("input[name=clock-style]").change(function(){a.clockStyle=$("input[name=clock-style]:checked").val();$(document).trigger("optionsChanged",a)});$defaultCarouselCateg.change(function(){$("#carousel-source li[data-categ='"+$(this).val()+"']").click()})}function toggleClockStyle(a){$("#clock-style input").attr("disabled",a);if(a){$("#clock-style").addClass("disabled")}else{$("#clock-style").removeClass("disabled")}}function toggleCarousel(a){if(a){$("#default-carousel-category select").attr("disabled","disabled")}else{$("#default-carousel-category select").removeAttr("disabled")}}function getOptions(a){chrome.storage.sync.get({showSearchBox:true,showCarousel:true,showClock:true,clockStyle:"default",carouselCategory:null},function(b){a(b)})}getOptions(function(a){$(document).trigger("optionsChanged",a)});$(document).ready(function(){$(document).on("optionsChanged",function(a,b){$("#searches").css("display",b.showSearchBox?"block":"none")});$("#search-type span").click(function(){var a=$(this);if(!a.hasClass("disabled")){return}$("#search-type span").addClass("disabled");a.removeClass("disabled");$("#searches .widget").removeClass("enabled");$widget=$("#searches #"+a[0].id+"-search");$widget.addClass("enabled");$widget.find("input[type=text]:not(:disabled)").focus()});["gettyimages","istockphoto"].forEach(function(a){$("#"+a+"-search-form input[type=text]").keyup(function(){$("#"+a+"-search-form").attr("action","http://"+a+".com/photos/"+$(this).val().replace(" ","+"))})})});function generateGuid(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}guid=null;function getGuid(){if(guid){return guid}guid=getCookie("guid");if(guid==""){guid=generateGuid();setCookie("guid",guid)}return guid}function track(b,c,f){var e;e={source:"Getty Chrome New Tab Extension",event:b,properties:c};c.installation_id=getGuid();var a=[];a[0]=e;var d=new XMLHttpRequest();d.onreadystatechange=function(){if(this.readyState==4&&this.status==200&&f){f()}};d.open("POST","http://spectrum.gettyimages.com/v3/signals",true);d.setRequestHeader("Content-type","Content-Type: application/json;charset=UTF-8");d.send(JSON.stringify(a))}function trackPageLoad(){getOptions(function(a){track("Page Loaded",{settings:a})})}function trackCarouselCategoryClicked(b,a){var c={category_name:b.name,positions:assetPositions(b)};if(a){c.initial_load=true}track("CarouselCategorizer Loaded",c)}function trackCarouselAssetClicked(a,b){trackImageInteraction("Asset Clicked",a,b)}function trackCarouselAssetHover(a){trackImageInteraction("Asset Hovered",a)}function trackImageInteraction(c,b,e){var a={asset_id:b.id,category_name:b.categ,position:b.position};if(b.metadata){for(var d in b.metadata){a[d]=b.metadata[d]}}track(c,a,e)}function trackCarouselPageClicked(a,b){var c={page_number:a,category_name:b.name,positions:assetPositions(b)};track("CarouselPager Clicked",c)}function assetPositions(a){positions=[];for(var b=0;b<a.assets.length;b++){positions.push({position:b,asset_id:a.assets[b].id})}return positions}$(document).ready(function(){trackPageLoad();$(".item").tooltip()});